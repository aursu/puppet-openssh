<%-
def value2config(b)
    case b
    when true,
        'yes'
    when false
        'no'
    else
        b.to_s
    end
end
-%>
### THIS FILE IS MANAGED BY PUPPET. DO NOT EDIT THIS FILE. ###
Port <%= @ssh_port %>
<% if @protocol %>
Protocol <%= @protocol %>
<% end %>

<% if @setup_host_key %>
HostKey /etc/ssh/ssh_host_rsa_key
HostKey /etc/ssh/ssh_host_ecdsa_key
<% if @ed25519_key_generate %>
HostKey /etc/ssh/ssh_host_ed25519_key
<% end %>

<% end %>
SyslogFacility AUTHPRIV
LoginGraceTime 60
PermitRootLogin <%= @permit_root_login %>

MaxAuthTries 20
MaxSessions 5

PubkeyAuthentication yes
<% if @keys_file %>
AuthorizedKeysFile <%= @keys_file %>
<% end %>

PasswordAuthentication <%= value2config(@password_authentication) %>
PermitEmptyPasswords no
ChallengeResponseAuthentication <%= value2config(@challenge_response_authentication) %>
GSSAPIAuthentication <%= @gss_api_authentication %>
GSSAPICleanupCredentials yes
UsePAM yes
X11Forwarding no
<% if @use_privilege_separation %>
UsePrivilegeSeparation <%= @use_privilege_separation %>
<% end %>

AcceptEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES
AcceptEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT
AcceptEnv LC_IDENTIFICATION LC_ALL LANGUAGE
AcceptEnv XMODIFIERS

Subsystem sftp /usr/libexec/openssh/sftp-server -f AUTHPRIV -l INFO

StrictModes <%= @strict_modes %>
HostbasedAuthentication <%= @hostbased_authentication %>
IgnoreRhosts yes

AllowTcpForwarding <%= @allow_tcp_forwarding %>
<% if @banner %>
Banner <%= @banner %>
<% end %>
PermitTunnel <%= @permit_tunnel %>
<% if @kexalgorithms %>
KexAlgorithms <%= Array(@kexalgorithms).join(',') %>
<% end %>
<% if @macs %>
MACs <%= Array(@macs).join(',') %>
<% end %>
<% if @ciphers %>
Ciphers <%= Array(@ciphers).join(',') %>
<% end %>
